36a37
> #include "glfw_adapter.h"
441c442
<   mjr_figure(viewport, &sim->figtimer, &sim->platform_ui->mjr_context());
---
>   mjr_figure(viewport, &sim->figtimer, &sim->platform_ui.mjr_context());
443c444
<   mjr_figure(viewport, &sim->figsize, &sim->platform_ui->mjr_context());
---
>   mjr_figure(viewport, &sim->figsize, &sim->platform_ui.mjr_context());
445c446
<   mjr_figure(viewport, &sim->figcost, &sim->platform_ui->mjr_context());
---
>   mjr_figure(viewport, &sim->figcost, &sim->platform_ui.mjr_context());
447c448
<   mjr_figure(viewport, &sim->figconstraint, &sim->platform_ui->mjr_context());
---
>   mjr_figure(viewport, &sim->figconstraint, &sim->platform_ui.mjr_context());
542c543
<   mjr_figure(viewport, &sim->figsensor, &sim->platform_ui->mjr_context());
---
>   mjr_figure(viewport, &sim->figsensor, &sim->platform_ui.mjr_context());
546c547
<   mjr_figure(viewport, fig, &sim->platform_ui->mjr_context());
---
>   mjr_figure(viewport, fig, &sim->platform_ui.mjr_context());
552c553
<               &sim->platform_ui->mjr_context());
---
>               &sim->platform_ui.mjr_context());
556c557
<   mjr_drawPixels(image, nullptr, viewport, &sim->platform_ui->mjr_context());
---
>   mjr_drawPixels(image, nullptr, viewport, &sim->platform_ui.mjr_context());
575c576
<   mjui_update(section, -1, &sim->ui0, &sim->uistate, &sim->platform_ui->mjr_context());
---
>   mjui_update(section, -1, &sim->ui0, &sim->uistate, &sim->platform_ui.mjr_context());
1224c1225
<   sim->platform_ui->SetClipboardString(clipboard);
---
>   sim->platform_ui.SetClipboardString(clipboard);
1266c1267
<   sim->platform_ui->SetClipboardString(clipboard);
---
>   sim->platform_ui.SetClipboardString(clipboard);
1415c1416
<     mjuiItem* it = mjui_event(&sim->ui0, state, &sim->platform_ui->mjr_context());
---
>     mjuiItem* it = mjui_event(&sim->ui0, state, &sim->platform_ui.mjr_context());
1455c1456
<         mjr_changeFont(50*(sim->font+1), &sim->platform_ui->mjr_context());
---
>         mjr_changeFont(50*(sim->font+1), &sim->platform_ui.mjr_context());
1457c1458
<         sim->platform_ui->ToggleFullscreen();
---
>         sim->platform_ui.ToggleFullscreen();
1459c1460
<         sim->platform_ui->SetVSync(sim->vsync);
---
>         sim->platform_ui.SetVSync(sim->vsync);
1463,1464c1464,1465
<       UiModify(&sim->ui0, state, &sim->platform_ui->mjr_context());
<       UiModify(&sim->ui1, state, &sim->platform_ui->mjr_context());
---
>       UiModify(&sim->ui0, state, &sim->platform_ui.mjr_context());
>       UiModify(&sim->ui1, state, &sim->platform_ui.mjr_context());
1484c1485
<         sim->pending_.copy_key_full_precision = sim->platform_ui->IsShiftKeyPressed();
---
>         sim->pending_.copy_key_full_precision = sim->platform_ui.IsShiftKeyPressed();
1584c1585
<         UiModify(&sim->ui1, state, &sim->platform_ui->mjr_context());
---
>         UiModify(&sim->ui1, state, &sim->platform_ui.mjr_context());
1604c1605
<     mjuiItem* it = mjui_event(&sim->ui1, state, &sim->platform_ui->mjr_context());
---
>     mjuiItem* it = mjui_event(&sim->ui1, state, &sim->platform_ui.mjr_context());
1756c1757
<         UiModify(&sim->ui0, state, &sim->platform_ui->mjr_context());
---
>         UiModify(&sim->ui0, state, &sim->platform_ui.mjr_context());
1760c1761
<         UiModify(&sim->ui1, state, &sim->platform_ui->mjr_context());
---
>         UiModify(&sim->ui1, state, &sim->platform_ui.mjr_context());
1874,1876c1875
< Simulate::Simulate(std::unique_ptr<PlatformUIAdapter> platform_ui,
<                    mjvCamera* cam, mjvOption* opt, mjvPerturb* pert,
<                    bool is_passive)
---
> Simulate::Simulate(PlatformUIAdapter* platform_ui, mjvCamera* cam, mjvOption* opt, mjvPerturb* pert, bool is_passive)
1881,1882c1880,1881
<       platform_ui(std::move(platform_ui)),
<       uistate(this->platform_ui->state()) {
---
>       platform_ui(platform_ui),
>       uistate(this->platform_ui.state()) {
1888c1887
< // operations which require holding the mutex, prevents racing with physics thread
---
> // operations which require holdinzg the mutex, prevents racing with physics thread
2342,2344c2341,2343
<   this->platform_ui->RefreshMjrContext(this->m_, 50*(this->font+1));
<   UiModify(&this->ui0, &this->uistate, &this->platform_ui->mjr_context());
<   UiModify(&this->ui1, &this->uistate, &this->platform_ui->mjr_context());
---
>   this->platform_ui.RefreshMjrContext(this->m_, 50*(this->font+1));
>   UiModify(&this->ui0, &this->uistate, &this->platform_ui.mjr_context());
>   UiModify(&this->ui1, &this->uistate, &this->platform_ui.mjr_context());
2346c2345
<   if (!this->platform_ui->IsGPUAccelerated()) {
---
>   if (!this->platform_ui.IsGPUAccelerated()) {
2381c2380
<     platform_ui->SetWindowTitle(title);
---
>     platform_ui.SetWindowTitle(title);
2397,2398c2396,2397
<   UiModify(&this->ui0, &this->uistate, &this->platform_ui->mjr_context());
<   UiModify(&this->ui1, &this->uistate, &this->platform_ui->mjr_context());
---
>   UiModify(&this->ui0, &this->uistate, &this->platform_ui.mjr_context());
>   UiModify(&this->ui1, &this->uistate, &this->platform_ui.mjr_context());
2427,2429c2426,2428
<   if (this->platform_ui->EnsureContextSize()) {
<     UiModify(&this->ui0, &this->uistate, &this->platform_ui->mjr_context());
<     UiModify(&this->ui1, &this->uistate, &this->platform_ui->mjr_context());
---
>   if (this->platform_ui.EnsureContextSize()) {
>     UiModify(&this->ui0, &this->uistate, &this->platform_ui.mjr_context());
>     UiModify(&this->ui1, &this->uistate, &this->platform_ui.mjr_context());
2447c2446
<                   &this->platform_ui->mjr_context());
---
>                   &this->platform_ui.mjr_context());
2453c2452
<                   &this->platform_ui->mjr_context());
---
>                   &this->platform_ui.mjr_context());
2459c2458
<                   &this->platform_ui->mjr_context());
---
>                   &this->platform_ui.mjr_context());
2464c2463
<       mjui_render(&this->ui0, &this->uistate, &this->platform_ui->mjr_context());
---
>       mjui_render(&this->ui0, &this->uistate, &this->platform_ui.mjr_context());
2467c2466
<       mjui_render(&this->ui1, &this->uistate, &this->platform_ui->mjr_context());
---
>       mjui_render(&this->ui1, &this->uistate, &this->platform_ui.mjr_context());
2471c2470
<     this->platform_ui->SwapBuffers();
---
>     this->platform_ui.SwapBuffers();
2529c2528
<       mjui_update(SECT_JOINT, -1, &this->ui1, &this->uistate, &this->platform_ui->mjr_context());
---
>       mjui_update(SECT_JOINT, -1, &this->ui1, &this->uistate, &this->platform_ui.mjr_context());
2539c2538
<       UiModify(&this->ui1, &this->uistate, &this->platform_ui->mjr_context());
---
>       UiModify(&this->ui1, &this->uistate, &this->platform_ui.mjr_context());
2546c2545
<       mjui_update(SECT_CONTROL, -1, &this->ui1, &this->uistate, &this->platform_ui->mjr_context());
---
>       mjui_update(SECT_CONTROL, -1, &this->ui1, &this->uistate, &this->platform_ui.mjr_context());
2552c2551
<   mjr_render(rect, &this->scn, &this->platform_ui->mjr_context());
---
>   mjr_render(rect, &this->scn, &this->platform_ui.mjr_context());
2557c2556
<                 &this->platform_ui->mjr_context());
---
>                 &this->platform_ui.mjr_context());
2571c2570
<                 &this->platform_ui->mjr_context());
---
>                 &this->platform_ui.mjr_context());
2597c2596
<                 &this->platform_ui->mjr_context());
---
>                 &this->platform_ui.mjr_context());
2602c2601
<     mjui_render(&this->ui0, &this->uistate, &this->platform_ui->mjr_context());
---
>     mjui_render(&this->ui0, &this->uistate, &this->platform_ui.mjr_context());
2607c2606
<     mjui_render(&this->ui1, &this->uistate, &this->platform_ui->mjr_context());
---
>     mjui_render(&this->ui1, &this->uistate, &this->platform_ui.mjr_context());
2613c2612
<                 &this->platform_ui->mjr_context());
---
>                 &this->platform_ui.mjr_context());
2619c2618
<                 &this->platform_ui->mjr_context());
---
>                 &this->platform_ui.mjr_context());
2640c2639
<     mjr_readPixels(rgb.get(), nullptr, uistate.rect[0], &this->platform_ui->mjr_context());
---
>     mjr_readPixels(rgb.get(), nullptr, uistate.rect[0], &this->platform_ui.mjr_context());
2680c2679
<   this->platform_ui->SwapBuffers();
---
>   this->platform_ui.SwapBuffers();
2701c2700
<   if (!this->platform_ui->IsGPUAccelerated()) {
---
>   if (!this->platform_ui.IsGPUAccelerated()) {
2711c2710
<   this->platform_ui->RefreshMjrContext(nullptr, fontscale);
---
>   this->platform_ui.RefreshMjrContext(nullptr, fontscale);
2718c2717
<   auto [buf_width, buf_height] = this->platform_ui->GetFramebufferSize();
---
>   auto [buf_width, buf_height] = this->platform_ui.GetFramebufferSize();
2737,2738c2736,2737
<   this->platform_ui->SetEventCallback(UiEvent);
<   this->platform_ui->SetLayoutCallback(UiLayout);
---
>   this->platform_ui.SetEventCallback(UiEvent);
>   this->platform_ui.SetLayoutCallback(UiLayout);
2750,2751c2749,2750
<   UiModify(&this->ui0, &this->uistate, &this->platform_ui->mjr_context());
<   UiModify(&this->ui1, &this->uistate, &this->platform_ui->mjr_context());
---
>   UiModify(&this->ui0, &this->uistate, &this->platform_ui.mjr_context());
>   UiModify(&this->ui1, &this->uistate, &this->platform_ui.mjr_context());
2754c2753
<   this->platform_ui->SetVSync(this->vsync);
---
>   this->platform_ui.SetVSync(this->vsync);
2760c2759
<   while (!this->platform_ui->ShouldCloseWindow() && !this->exitrequest.load()) {
---
>   while (!this->platform_ui.ShouldCloseWindow() && !this->exitrequest.load()) {
2772c2771
<       this->platform_ui->PollEvents();
---
>       this->platform_ui.PollEvents();
2777c2776
<         mjr_uploadHField(m_, &platform_ui->mjr_context(), hfield_upload_);
---
>         mjr_uploadHField(m_, &platform_ui.mjr_context(), hfield_upload_);
2782c2781
<         mjr_uploadMesh(m_, &platform_ui->mjr_context(), mesh_upload_);
---
>         mjr_uploadMesh(m_, &platform_ui.mjr_context(), mesh_upload_);
2787c2786
<         mjr_uploadTexture(m_, &platform_ui->mjr_context(), texture_upload_);
---
>         mjr_uploadTexture(m_, &platform_ui.mjr_context(), texture_upload_);
